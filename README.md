# Web-ларёк

## Описание
Интернет-магазин для разработчиков.

### Архитектура
Построен в соответствии с архитектурой MVP: бизнес-логика и работа с данными происходят в слое моделей (Model), а за работу с интерфейсом отвечает слой отображения (View).
Слои связаны брокером событий (Presenter).

### Стек:
- HTML
- SASS
- TS
- Webpack

### Структура проекта:
- src/ — исходный код проекта
- src/components/ — компоненты
- src/components/base/ — базовые компоненты
- src/components/model/ - компоненты слоя моделей
- src/components/view/ - компоненты слоя отображения
- src/types/ - типы
- src/styles/ - стили
- src/utils/ - утилиты

### Важные файлы:
- src/index.ts — точка входа приложения
- src/constants.ts — константы
- src/pages/index.html — главная страница
- src/styles/styles.scss — стили
- src/utils/utils.ts — утилиты

## Классы

### Класс `BaseApi` - базовый класс для работы с API
Свойства:
- `baseUrl` - базовый URL
- `options` - опции запроса

Методы:
- `handleResponse` - обрабатывает ответ сервера
- `get` - делает GET-запрос на сервер
- `post` - делает POST-запрос на сервер

### Класс `Api` - работа с API
Свойства:
- `cdnUrl` - CDN URL

Методы:
- `getProductList(): Promise<IProductItem[]>` - получает список товаров
- `placeOrder(order: IOrder): Promise<IOrderResponse>` - оформляет заказ

### Класс `EventEmitter` - брокер событий
Свойства:
- `_events` - коллекция подписчиков, где ключом выступает имя события (строка или RegExp), а значением — набор обработчиков

Методы:
- `on` - устанавливает обработчик на событие (поддерживает имя события-строку и шаблон RegExp)
- `off` - снимает указанный обработчик с события
- `emit` - инициирует событие с данными; вызывает обработчики по точному совпадению имени, по шаблону RegExp, а также обработчики, подписанные на все события (`"*"`)
- `onAll` - подписывается на все события сразу
- `offAll` - сбрасывает все установленные обработчики
- `trigger` - возвращает коллбек, который при вызове генерирует указанное событие, объединяя переданные данные с контекстом

### Класс `AppModel` - общая модель приложения
Свойства:
- `_products` - список продуктов в приложении
- `_activeProduct` - текущий активный (выбранный) продукт
- `activeProduct` - геттер/сеттер активного продукта; при установке не-null генерирует событие `productModal:open` с продуктом
- `productList` - геттер/сеттер списка продуктов; при установке генерирует событие `productList:updated` с новым списком

Методы:
- Конструктор(events) - принимает брокер событий для уведомлений об изменениях модели

### Класс CartModel - модель корзины
Свойства:
- `products` — список товаров в корзине (можно заменить целиком через сеттер)
- `productsCount` — количество товаров в корзине
- `total` — общая стоимость товаров в корзине

Методы:
- `addProduct` — добавляет товар в корзину, если его там ещё нет (по id)
- `deleteProduct` — удаляет товар из корзины (по id)
- `hasProduct` — проверяет есть ли продукт в корзине
- `clear` — очищает корзину (удаляет все товары)

### Класс CheckoutModel — модель оформления заказа
Свойства:
- `totalAmount` — общая сумма заказа (getter/setter)
- `orderData` — данные заказа: payment, address, email, phone, total, items (список id товаров)

Методы:
- `updateField` — обновляет значение поля (с учётом форматирования), валидирует поля шага и эмитит событие checkout:{step}Errors с массивом ошибок шага
- `validateStepFields` — валидирует все поля указанного шага (Order или Contacts)
- `setOrderIds` — устанавливает список id товаров в заказе

### Класс CartItemView - представление элемента корзины
Свойства:
- `cartItem` - корневой DOM-элемент элемента корзины
- `index` - DOM-элемент индекса позиции в списке
- `title` - DOM-элемент названия товара
- `price` - DOM-элемент цены товара
- `deleteButton` - кнопка удаления товара

Методы:
- `render` - заполняет элементы данными товара (название, цена, индекс), форматирует цену и возвращает готовый DOM-элемент элемента корзины

### Класс CartView - представление корзины
Свойства:
- `cartRoot` - корневой DOM-элемент корзины
- `titleEl` - DOM-элемент заголовка модального окна
- `itemListEl` - контейнер списка элементов корзины
- `checkoutBtn` - кнопка перехода к оформлению заказа
- `totalEl` - DOM-элемент отображения общей суммы
- `openCartBtn` - кнопка открытия корзины в шапке
- `cartCounterEl` - индикатор количества товаров в шапке

Методы:
- `setItems` - обновляет список элементов корзины; при пустом списке показывает сообщение "Корзина пуста" и блокирует кнопку оформления
- `updateTotal` - обновляет отображение общей суммы заказа
- `render` - подготавливает и возвращает DOM-элемент корзины

События:
- `cart:open` - эмитится при клике по кнопке открытия корзины
- `order:open` - эмитится при клике по кнопке оформления заказа

### Класс FormView — представление формы
Свойства:
- formEl — корневой DOM-элемент формы (HTMLFormElement)
- errorsEl — контейнер для вывода текстов ошибок (HTMLElement)
- submitButton — кнопка отправки формы (HTMLButtonElement)
- inputEls — список полей ввода формы (HTMLInputElement[])

Параметры конструктора:
- template — HTMLTemplateElement, источник разметки формы
- events — шина событий (IEvents) для эмита и подписок
- options (FormOptions):
  - formSelector — селектор корневого элемента формы внутри template
  - errorsSelector — селектор контейнера ошибок внутри формы
  - submitSelector — селектор кнопки отправки
  - inputSelector — селектор полей ввода
  - inputChangeEvent — имя события, эмитируемого при изменении любого поля ввода
  - submitEvent — имя события, эмитируемого при отправке формы

Методы:
- set valid(value: boolean) — включает/отключает кнопку отправки (disabled = !value)
- renderErrors(value: string) — выводит текст ошибки в errorsEl
- render(): HTMLElement — возвращает корневой DOM-элемент формы для вставки в документ
- clear() — сбрасывает состояние формы: очищает ошибки, поля ввода и отключает кнопку отправки

События:
- inputChangeEvent — эмитится при изменении любого поля ввода
- submitEvent — эмитится при отправке формы

### Класс OrderView — представление формы заказа
Свойства:
- `formEl` — корневой DOM-элемент формы
- `errorsEl` — контейнер вывода ошибок формы
- `submitButton` — кнопка отправки формы
- `inputEls` — список полей ввода формы
- `paymentButtons` — массив кнопок выбора способа оплаты

Методы:
- `set payment(paymentMethod: string)` — визуально отмечает выбранный способ оплаты, добавляя класс `button_alt-active` соответствующей кнопке
- `clear()` — сбрасывает состояние формы и снимает выделение со всех кнопок оплаты (вызывает `super.clear()`)

События:
- `order:fieldChange` — эмитится при изменении любого поля формы; также эмитится при выборе способа оплаты
- `order:paymentChange` — эмитится при клике по кнопке выбора оплаты (в payload передаётся DOM-кнопка)
- `contacts:open` — эмитится при отправке формы (переход к следующему шагу)

### Класс ContactsView — представление формы контактов

Свойства:
- `formEl` — корневой DOM-элемент формы
- `errorsEl` — контейнер вывода ошибок формы
- `submitButton` — кнопка отправки формы
- `inputEls` — список полей ввода формы

Методы:
- Использует методы родительского класса FormView (собственных дополнительных методов не добавляет)

События:
- `contacts:fieldChange` — эмитится при изменении любого поля формы
- `success:open` — эмитится при отправке формы (переход к экрану успешного оформления)

### Класс ModalView - представление модального окна
Свойства:
- `modalContainer` - корневой DOM-элемент модального окна
- `closeButton` - кнопка закрытия модального окна
- `content` - контейнер для контента модального окна
- `pageWrapper` - обертка страницы для блокировки прокрутки

Методы:
- `open` - открывает модальное окно и блокирует прокрутку страницы
- `close` - закрывает модальное окно, очищает контент и разблокирует прокрутку
- `setContent` - устанавливает контент модального окна

Особенности:
- Закрытие по клику на кнопку закрытия и по клику на фон (оверлей)
- Клик внутри контейнера модалки не приводит к закрытию (остановка всплытия)

### Класс ProductDetailsView - модалка с подробностями о товаре (наследуется от ProductView)
Свойства:
- `textEl` - элемент с описанием товара
- `buttonEl` - кнопка действия на карточке товара

Методы:
- `render` - заполняет карточку данными товара, обновляет состояние кнопки с учетом корзины и возвращает готовый DOM-элемент
- `updateButtonState (private)` - обновляет текст и доступность кнопки в зависимости от цены и наличия товара в корзине (Не продается / Уже в корзине / Купить)

### Класс ProductView - базовое представление карточки товара
Свойства:
- `productEl` - корневой DOM-элемент карточки
- `productCategory` - элемент с категорией товара
- `productTitle` - элемент с названием товара
- `productImage` - изображение товара
- `productPrice` - элемент с ценой товара

Методы:
- `setProductCategory` - устанавливает текст категории и CSS-модификатор на основе CATTEGORIES_MAP
- `render` - заполняет карточку данными товара и возвращает готовый DOM-элемент

### Класс SuccessView - модалка успешного завершения заказа
Свойства:
- `successEl` - корневой DOM-элемент модального окна
- `descriptionEl` - элемент с текстом описания (сумма списания)
- `closeButton` - кнопка закрытия модалки

Методы:
- `render` - устанавливает текст с итоговой суммой списания и возвращает готовый DOM-элемент

Дополнительно:
- В конструкторе навешивает обработчик на closeButton, который эмитит событие 'success:close' через events при закрытии модалки

### Класс Api - модуль для работы с API сервера
Свойства:
- `cdnUrl` - базовый URL CDN для формирования полных ссылок на изображения

Методы:
- `getProductList` - получает список товаров и подставляет полный URL изображения (cdnUrl + image)
- `placeOrder` - оформляет заказ и возвращает ответ сервера

## Установка и запуск

```
npm install
npm run start
```
## Сборка

```
npm run build
```
